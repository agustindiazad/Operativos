Implementación de chmod en xv6 (RISC-V)

Alumno: Agustín Díaz
Curso: Sistemas Operativos

Objetivo

El objetivo de esta tarea fue implementar una nueva syscall, chmod, en el sistema operativo xv6. Esta syscall debía permitir modificar los permisos de un archivo para establecer accesos de solo lectura, lectura/escritura, o inmutable. Adicionalmente, se desarrolló un programa de pruebas para validar el funcionamiento correcto de la implementación.

Pasos Seguidos

Modificación de struct dinode
Se añadió un campo para representar los permisos en la estructura de metadatos de los archivos (struct dinode). Esto permitió almacenar los permisos asociados a cada archivo. También se ajustó el tamaño de la estructura para que sea divisible por el tamaño del bloque del sistema de archivos (1024 bytes).

Implementación de la syscall chmod
Se agregó la syscall chmod en el núcleo del sistema (sysproc.c). Esta syscall realiza las siguientes operaciones:

Obtiene la ruta del archivo y los permisos nuevos.
Verifica que el archivo exista y que los permisos sean válidos.
Bloquea cualquier cambio si el archivo está marcado como inmutable.
Cambia los permisos del archivo si todas las condiciones se cumplen.
Desarrollo del Programa de Pruebas
Se implementó un programa de usuario para probar el comportamiento de la syscall en distintas situaciones:
Crear un archivo y escribir datos en él.
Cambiar los permisos a solo lectura e intentar escribir en el archivo (debe fallar).
Restaurar los permisos a lectura/escritura.
Marcar el archivo como inmutable y verificar que no se puedan modificar los permisos.
Ajustes de Tamaño de struct dinode
Se verificó el tamaño de la estructura struct dinode para garantizar que sea un divisor exacto de 1024 bytes, como lo requiere el sistema de archivos de xv6. Se realizaron ajustes con relleno para cumplir esta restricción.

Actualización de Makefile
Se actualizó el archivo Makefile para incluir el programa de prueba en el proceso de compilación.

Compilación y Pruebas
Se recompiló el sistema operativo y se generó una nueva imagen del sistema de archivos. Las pruebas se ejecutaron en el entorno de xv6 para confirmar el correcto funcionamiento de la syscall.

Resultados

Las pruebas mostraron que:

Los permisos de los archivos se aplicaron correctamente según lo especificado.
Los intentos de modificar archivos inmutables fallaron, como se esperaba.
Los errores de permisos fueron detectados y manejados apropiadamente.
La salida final del programa de pruebas confirmó que la implementación fue exitosa.

Conclusión

La tarea permitió comprender en profundidad cómo funcionan las syscalls, los sistemas de archivos y la manipulación de estructuras de datos en xv6. Además, se reforzaron habilidades en depuración y validación de cambios en sistemas operativos.
